<?xml version="1.0"?>
<bakefile>

  <!-- Set extra linker informations -->
  <!-- AT THE MOMENT THIS MODIFICATION WILL ONLY SUPPORT GCC (windows and linux)... Make better changes for Visual Studio -->
  <set var="orxLINKLIB">
    <if cond="FORMAT=='gnu'">dl</if>
  </set>

  <set var="orxLDFLAGS">
    <if cond="LINK=='static' and COMPILER=='gcc'">-Wl,--export-dynamic -Wl,--whole-archive -lorx$(orxSUFFIX) -lm -Wl,--no-whole-archive</if>
    <if cond="LINK=='dynamic' and COMPILER=='gcc'">-lorx$(orxSUFFIX)</if>
  </set>

  <set var="orxLDFLAGS_IMPLIB">
    <if cond="LINK=='static' and FORMAT=='mingw'">-Wl,--export-all-symbols -Wl,--out-implib,$(orxLIBDIR)$(DIRSEP)testbed.a</if>
  </set>
  
  <set var="orxDYNLINK">
    <if cond="LINK=='dynamic' and FORMAT=='mingw'">-Wl,--out-implib,$(orxLIBDIR)$(DIRSEP)testbed.a</if>
  </set>

  <!--- Create main program -->
  <exe id="testbed" template="orxBASE,orxLINK">
    <dirname>bin</dirname>
    <app-type>console</app-type> <!-- Windows specific : gui/console change the link behaviour -->
  
    <ldflags>$(orxLDFLAGS) $(orxLDFLAGS_IMPLIB)</ldflags>
    <sys-lib>$(orxLINKLIB)</sys-lib>
    <sources>test/orxTest_Main.c</sources>
  </exe>

  <!--- Create orx test module -->
  <module id="Memory" template="orxBASE,orxLINK,orxMODULELINK">
    <dirname>bin/modules</dirname>
    <sources>test/orxTest_Memory.c</sources>
  </module>

  <module id="Bank" template="orxBASE,orxLINK,orxMODULELINK">
    <dirname>bin/modules</dirname>
    <sources>test/orxTest_Bank.c</sources>
  </module>

  <module id="HashTable" template="orxBASE,orxLINK,orxMODULELINK">
    <dirname>bin/modules</dirname>
    <sources>test/orxTest_HashTable.c</sources>
  </module>

  <module id="Sound" template="orxBASE,orxLINK,orxMODULELINK">
    <dirname>bin/modules</dirname>
    <sources>test/orxTest_Sound.c</sources>
  </module>

  <module id="Plugin" template="orxBASE,orxLINK,orxMODULELINK">
    <dirname>bin/modules</dirname>
    <sources>test/orxTest_Plugin.c</sources>
  </module>

</bakefile>
